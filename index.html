<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="VisionCare Smart ICU System">
    <title>VisionCare Enterprise | Titan OS v8</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        /* =======================================================================
           1.0 GLOBAL STYLESHEET (MEDI-UI PRO FRAMEWORK)
           ======================================================================= */

        /* -----------------------------------------------------------------------
           1.1 CSS VARIABLES & THEME CONFIGURATION
           ----------------------------------------------------------------------- */
        :root {
            /* Application Backgrounds */
            --color-bg-root:       #020617; /* Deepest Navy */
            --color-bg-sidebar:    #0f172a; /* Slate 900 */
            --color-bg-panel:      #1e293b; /* Slate 800 */
            --color-bg-card:       #334155; /* Slate 700 */
            --color-bg-input:      #1e293b; 
            
            /* Brand Identity Colors */
            --color-primary:       #6366f1; /* Indigo 500 */
            --color-primary-hover: #4f46e5; /* Indigo 600 */
            --color-primary-dim:   rgba(99, 102, 241, 0.15);
            
            /* Semantic Colors */
            --color-accent:        #06b6d4; /* Cyan 500 */
            --color-success:       #10b981; /* Emerald 500 */
            --color-warning:       #f59e0b; /* Amber 500 */
            --color-danger:        #ef4444; /* Red 500 */
            --color-info:          #3b82f6; /* Blue 500 */
            
            /* Typography Colors */
            --color-text-main:     #f8fafc; /* Slate 50 */
            --color-text-muted:    #94a3b8; /* Slate 400 */
            --color-text-dark:     #0f172a;
            
            /* Structural Variables */
            --border-color:        rgba(255, 255, 255, 0.08);
            --border-width:        1px;
            --border-radius-sm:    6px;
            --border-radius-md:    12px;
            --border-radius-lg:    20px;
            
            /* Layout Dimensions */
            --sidebar-width:       280px;
            --header-height:       70px;
            
            /* Gaze Tracking Cursor */
            --cursor-x: 50%;
            --cursor-y: 50%;
        }

        /* -----------------------------------------------------------------------
           1.2 HIGH CONTRAST ACCESSIBILITY THEME
           ----------------------------------------------------------------------- */
        body.theme-high-contrast {
            --color-bg-root:       #000000;
            --color-bg-sidebar:    #000000;
            --color-bg-panel:      #000000;
            --color-bg-card:       #121212;
            --color-bg-input:      #222222;
            
            --color-primary:       #FFFF00; /* Yellow for visibility */
            --color-primary-hover: #FFD700;
            --color-primary-dim:   rgba(255, 255, 0, 0.2);
            
            --color-accent:        #00FFFF; /* Cyan */
            --color-success:       #00FF00; /* Green */
            --color-danger:        #FF0000; /* Red */
            
            --color-text-main:     #FFFFFF;
            --color-text-muted:    #E0E0E0;
            
            --border-color:        #FFFFFF;
            --border-width:        2px;
        }

        /* -----------------------------------------------------------------------
           1.3 GLOBAL RESET & BASE STYLES
           ----------------------------------------------------------------------- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 14px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--color-bg-root);
            color: var(--color-text-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
        }

        /* -----------------------------------------------------------------------
           1.4 UTILITY CLASSES & HELPERS
           ----------------------------------------------------------------------- */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .flex-grow { flex-grow: 1; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .uppercase { text-transform: uppercase; }
        .pointer { cursor: pointer; }
        .overflow-hidden { overflow: hidden; }
        .overflow-y-auto { overflow-y: auto; }

        /* Spacing Utilities */
        .m-0 { margin: 0; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .p-0 { padding: 0; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }

        /* Text Color Utilities */
        .text-primary { color: var(--color-primary); }
        .text-accent { color: var(--color-accent); }
        .text-success { color: var(--color-success); }
        .text-danger { color: var(--color-danger); }
        .text-warning { color: var(--color-warning); }
        .text-muted { color: var(--color-text-muted); }

        /* -----------------------------------------------------------------------
           1.5 COMPONENT: BUTTONS
           ----------------------------------------------------------------------- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s ease-in-out;
            user-select: none;
        }

        .btn:active { transform: scale(0.98); }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
            color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:hover {
            box-shadow: 0 0 15px var(--color-primary-dim);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border-color: var(--border-color);
            color: var(--color-text-main);
        }
        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--color-text-muted);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--color-danger);
            border-color: rgba(239, 68, 68, 0.3);
        }
        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
        }

        /* -----------------------------------------------------------------------
           1.6 COMPONENT: CARDS & CONTAINERS
           ----------------------------------------------------------------------- */
        .card {
            background-color: var(--color-bg-panel);
            border: var(--border-width) solid var(--border-color);
            border-radius: var(--border-radius-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s ease;
        }
        .card:hover {
            border-color: rgba(255, 255, 255, 0.15);
        }

        .card-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-text-main);
        }

        .card-body {
            padding: 1.25rem;
            flex: 1;
            overflow-y: auto;
        }

        /* -----------------------------------------------------------------------
           1.7 COMPONENT: FORM INPUTS
           ----------------------------------------------------------------------- */
        .form-control {
            width: 100%;
            padding: 0.85rem 1rem;
            background-color: var(--color-bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            color: var(--color-text-main);
            font-size: 1rem;
            transition: all 0.2s;
        }
        .form-control:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-primary-dim);
        }

        /* -----------------------------------------------------------------------
           1.8 ANIMATIONS & KEYFRAMES
           ----------------------------------------------------------------------- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        /* -----------------------------------------------------------------------
           1.9 SPECIAL: GAZE TRACKING CURSOR
           ----------------------------------------------------------------------- */
        #gaze-cursor {
            position: fixed;
            top: var(--cursor-y);
            left: var(--cursor-x);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: rgba(239, 68, 68, 0.6); /* Red transparent */
            border: 2px solid white;
            z-index: 99999;
            pointer-events: none; /* Allows clicking through */
            transform: translate(-50%, -50%);
            display: none; /* Hidden by default */
            box-shadow: 0 0 15px var(--color-danger);
            transition: top 0.05s linear, left 0.05s linear; /* Smooth movement */
        }
        #gaze-cursor.active {
            display: block;
        }
        #gaze-cursor.clicking {
            background-color: var(--color-success);
            transform: translate(-50%, -50%) scale(0.8);
        }

        /* =======================================================================
           2.0 LAYOUT & NAVIGATION STYLES
           ======================================================================= */
        
        /* 2.1 AUTHENTICATION OVERLAY */
        #auth-view {
            position: fixed;
            inset: 0;
            z-index: 10000;
            background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-panel {
            width: 450px;
            padding: 3rem;
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* 2.2 APP SIDEBAR */
        aside {
            width: var(--sidebar-width);
            background-color: var(--color-bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            z-index: 50;
        }
        .brand-logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--color-text-main);
            margin-bottom: 2.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: -0.5px;
        }
        .brand-logo i { color: var(--color-primary); }

        .nav-item {
            padding: 0.85rem 1rem;
            margin-bottom: 0.25rem;
            border-radius: var(--border-radius-md);
            color: var(--color-text-muted);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
        }
        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--color-text-main);
        }
        .nav-item.active {
            background-color: var(--color-primary-dim);
            color: var(--color-primary);
            border-left: 3px solid var(--color-primary);
        }

        /* 2.3 MAIN CONTENT AREA */
        .main-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Header */
        header {
            height: var(--header-height);
            border-bottom: 1px solid var(--border-color);
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(10px);
            z-index: 40;
        }

        /* Viewport */
        .viewport {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            position: relative;
        }
        .view-page {
            display: none;
            height: 100%;
            flex-direction: column;
            animation: fadeIn 0.4s ease;
        }
        .view-page.active {
            display: flex;
        }

        /* =======================================================================
           3.0 DASHBOARD WIDGETS
           ======================================================================= */
        
        /* 3.1 GRID SYSTEM */
        .grid-dashboard {
            display: grid;
            grid-template-columns: 2.5fr 1fr;
            grid-template-rows: 55% 45%;
            gap: 1.5rem;
            height: 100%;
        }

        /* 3.2 CAMERA FEED WIDGET */
        .widget-camera {
            grid-column: 1 / 2;
            grid-row: 1 / 2;
            background-color: #000;
            border-radius: var(--border-radius-lg);
            border: 2px solid var(--border-color);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        video#vid_feed { position: absolute; width: 100%; height: 100%; object-fit: contain; transform: scaleX(-1); }
        canvas#cv_canvas { position: absolute; width: 100%; height: 100%; object-fit: contain; transform: scaleX(-1); z-index: 10; }

        /* 3.3 HEAD UP DISPLAY (HUD) */
        .hud-container {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            z-index: 20;
            background-color: rgba(0, 0, 0, 0.85);
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: var(--border-radius-md);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--color-success);
            min-width: 200px;
            pointer-events: none;
        }
        .hud-line { display: flex; justify-content: space-between; margin-bottom: 0.25rem; }
        .hud-label { color: var(--color-text-muted); }

        /* 3.4 CAMERA CONTROLS DOCK */
        .cam-dock {
            position: absolute;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 30;
            display: flex;
            gap: 1rem;
            background-color: rgba(15, 23, 42, 0.95);
            padding: 0.75rem 1.25rem;
            border-radius: 50px;
            border: 1px solid var(--border-color);
        }

        /* 3.5 DIGITAL TWIN & LEGEND */
        .side-stack {
            grid-column: 2 / 3;
            grid-row: 1 / 3;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .widget-twin {
            flex: 1;
            background-color: #000;
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--color-accent);
            position: relative;
            overflow: hidden;
        }
        .widget-legend {
            flex: 1;
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* 3.6 PATIENT MONITORING DECK */
        .patient-deck {
            grid-column: 1 / 2;
            grid-row: 2 / 3;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        .patient-card {
            background-color: var(--color-bg-card);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: all 0.3s ease;
        }
        .patient-card.status-danger {
            border-color: var(--color-danger);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.25);
        }

        /* ECG Visualizer */
        .ecg-wrapper {
            flex: 1;
            background-color: #000;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
        }
        .ecg-canvas { width: 100%; height: 70%; }
        .spo2-canvas { width: 100%; height: 30%; border-top: 1px solid #333; }

        /* =======================================================================
           4.0 TOAST NOTIFICATIONS
           ======================================================================= */
        .toast-wrapper {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 12000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            pointer-events: none;
        }
        .toast {
            width: 340px;
            padding: 1rem;
            background-color: #ffffff;
            color: #000000;
            border-radius: var(--border-radius-md);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 5px solid var(--color-primary);
            pointer-events: auto;
        }
        .toast.show { transform: translateX(0); }
        .toast.danger { border-left-color: var(--color-danger); background-color: #fef2f2; color: #991b1b; }

    </style>
</head>
<body>

    <div id="gaze-cursor"></div>

    <div id="auth-view">
        <div class="login-panel">
            <div style="font-size: 4rem; color: var(--color-primary); margin-bottom: 1.5rem;">
                <i class="fas fa-user-md"></i>
            </div>
            <h1 class="font-bold text-xl mb-2">VisionCare Titan OS</h1>
            <p class="text-muted mb-4">Enterprise Medical Command Center</p>
            
            <div class="form-group">
                <input type="text" id="login-id" class="form-control text-center" placeholder="Operator ID (admin)" value="admin">
            </div>
            <div class="form-group">
                <input type="password" id="login-key" class="form-control text-center" placeholder="Access Key (admin123)" value="admin123">
            </div>
            <button class="btn btn-primary w-full mt-4" onclick="AppKernel.login()">
                <i class="fas fa-power-off"></i> INITIALIZE SYSTEM
            </button>
            <div class="mt-4 text-xs text-muted">v8.0.0 | HIPAA Compliant Secure Build</div>
        </div>
    </div>

    <div id="app-shell" class="hidden h-full w-full flex">
        
        <aside>
            <div class="brand-logo">
                <i class="fas fa-eye"></i> VisionCare
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" onclick="Router.navigate('dashboard')">
                    <i class="fas fa-desktop"></i> Monitor
                </li>
                <li class="nav-item" onclick="Router.navigate('analytics')">
                    <i class="fas fa-chart-pie"></i> Analytics
                </li>
                <li class="nav-item" onclick="Router.navigate('chat')">
                    <i class="fas fa-comments"></i> Staff Chat
                </li>
                <li class="nav-item" onclick="Router.navigate('logs')">
                    <i class="fas fa-clipboard-list"></i> Audit Logs
                </li>
                <li class="nav-item" onclick="Router.navigate('settings')">
                    <i class="fas fa-cogs"></i> System
                </li>
            </ul>
            <div class="sidebar-footer">
                <div class="footer-label">ACCESSIBILITY</div>
                <li class="nav-item" onclick="document.body.classList.toggle('theme-high-contrast')">
                    <i class="fas fa-adjust"></i> High Contrast
                </li>
                <li class="nav-item text-danger" onclick="window.location.reload()">
                    <i class="fas fa-sign-out-alt"></i> Shutdown
                </li>
            </div>
        </aside>

        <div class="main-wrapper">
            <header>
                <div class="flex flex-col">
                    <h2 class="font-bold text-lg">ICU Ward 104 - Cardiac Unit</h2>
                    <span class="text-xs text-muted" id="sys-clock">00:00:00 UTC</span>
                </div>
                <div class="flex items-center gap-4">
                    <span class="badge badge-success">‚óè ONLINE</span>
                    <div class="text-right">
                        <div class="font-bold text-sm">Dr. Administrator</div>
                        <div class="text-xs text-muted">Chief of Surgery</div>
                    </div>
                    <div style="width:40px; height:40px; background:var(--color-primary); border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">DA</div>
                </div>
            </header>

            <div class="viewport">
                
                <div id="view-dashboard" class="view-page active">
                    <div class="grid-dashboard">
                        
                        <div class="widget-camera">
                            <video id="vid_feed" playsinline muted></video>
                            <canvas id="cv_canvas"></canvas>
                            
                            <div class="hud-container">
                                <div class="hud-line"><span class="hud-label">AI ENGINE:</span> <span class="text-success" id="hud-ai">STANDBY</span></div>
                                <div class="hud-line"><span class="hud-label">HANDS (L/R):</span> <span class="text-info" id="hud-hands">0 / 0</span></div>
                                <div class="hud-line"><span class="hud-label">ACTION:</span> <span class="text-warning" id="hud-cmd">--</span></div>
                                <div class="hud-line" style="margin-top:8px; border-top:1px solid #333; padding-top:4px;">
                                    <span class="hud-label">FALL RISK:</span> <span id="hud-fall">SAFE</span>
                                </div>
                            </div>

                            <div class="cam-dock">
                                <button class="btn btn-primary" onclick="VisionKernel.start()">
                                    <i class="fas fa-play"></i> START AI
                                </button>
                                <button class="btn btn-outline" onclick="GazeKernel.toggle()">
                                    <i class="fas fa-eye"></i> GAZE
                                </button>
                                <button class="btn btn-outline" onclick="VoiceKernel.toggle()">
                                    <i class="fas fa-microphone"></i> VOICE
                                </button>
                            </div>
                        </div>

                        <div class="side-stack">
                            <div class="widget-twin">
                                <canvas id="twin_canvas"></canvas>
                                <div class="absolute top-2 left-2 text-xs font-bold text-accent bg-black/50 px-2 py-1 rounded">DIGITAL TWIN</div>
                            </div>
                            <div class="widget-legend">
                                <div class="card-header font-bold text-xs uppercase text-muted">Gesture Map</div>
                                <div class="card-body p-2">
                                    <div class="flex items-center gap-4 p-2 bg-white/5 rounded mb-2">
                                        <i class="fas fa-hand-rock text-xl w-8 text-center"></i>
                                        <div><div class="font-bold">Fist (0)</div><div class="text-xs text-muted">Emergency</div></div>
                                    </div>
                                    <div class="flex items-center gap-4 p-2 bg-white/5 rounded mb-2">
                                        <i class="fas fa-hand-peace text-xl w-8 text-center"></i>
                                        <div><div class="font-bold">V-Sign (2)</div><div class="text-xs text-muted">Water Request</div></div>
                                    </div>
                                    <div class="flex items-center gap-4 p-2 bg-white/5 rounded mb-2">
                                        <i class="fas fa-hand-paper text-xl w-8 text-center"></i>
                                        <div><div class="font-bold">Palm (5)</div><div class="text-xs text-muted">Toggle Lights</div></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="patient-deck">
                            <div class="patient-card" id="card-p1">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex gap-3">
                                        <div style="width:50px; height:50px; background:#334155; border-radius:12px;"></div>
                                        <div>
                                            <h3 class="font-bold">Alex Smith</h3>
                                            <div class="text-xs text-muted">Bed 1 ‚Ä¢ Cardiac</div>
                                        </div>
                                    </div>
                                    <span class="badge badge-success" id="status-p1">STABLE</span>
                                </div>
                                <div class="ecg-wrapper">
                                    <canvas id="ecg-p1" class="ecg-canvas"></canvas>
                                    <canvas id="spo2-p1" class="spo2-canvas"></canvas>
                                </div>
                                <div class="text-center font-bold text-xl mb-4" id="req-p1">--</div>
                                <div class="flex gap-2">
                                    <button class="btn btn-outline flex-grow" id="btn-light-p1"><i class="fas fa-lightbulb"></i></button>
                                    <button class="btn btn-outline flex-grow" id="btn-fan-p1"><i class="fas fa-fan"></i></button>
                                </div>
                            </div>

                            <div class="patient-card" id="card-p2">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="flex gap-3">
                                        <div style="width:50px; height:50px; background:#334155; border-radius:12px;"></div>
                                        <div>
                                            <h3 class="font-bold">Sarah Doe</h3>
                                            <div class="text-xs text-muted">Bed 2 ‚Ä¢ Ortho</div>
                                        </div>
                                    </div>
                                    <span class="badge badge-success" id="status-p2">STABLE</span>
                                </div>
                                <div class="ecg-wrapper">
                                    <canvas id="ecg-p2" class="ecg-canvas"></canvas>
                                    <canvas id="spo2-p2" class="spo2-canvas"></canvas>
                                </div>
                                <div class="text-center font-bold text-xl mb-4" id="req-p2">--</div>
                                <div class="flex gap-2">
                                    <button class="btn btn-outline flex-grow" id="btn-light-p2"><i class="fas fa-lightbulb"></i></button>
                                    <button class="btn btn-outline flex-grow" id="btn-fan-p2"><i class="fas fa-fan"></i></button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div id="view-logs" class="view-page">
                    <div class="card h-full">
                        <div class="card-header">
                            <span class="card-title">System Audit Trail</span>
                            <button class="btn btn-danger btn-sm" onclick="DataKernel.clear()">Purge Logs</button>
                        </div>
                        <div class="card-body p-0">
                            <table style="width:100%; border-collapse: collapse;">
                                <thead style="text-align: left; background: rgba(0,0,0,0.2); border-bottom: 1px solid var(--border-color);">
                                    <tr>
                                        <th class="p-4">Timestamp</th>
                                        <th class="p-4">Module</th>
                                        <th class="p-4">Event</th>
                                        <th class="p-4">Severity</th>
                                    </tr>
                                </thead>
                                <tbody id="log-body">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="view-settings" class="view-page">
                    <div class="grid-dashboard">
                        <div class="card">
                            <div class="card-header">Voice Configuration</div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">Voice Volume</label>
                                    <input type="range" class="form-range" min="0" max="1" step="0.1" onchange="VoiceKernel.volume=this.value">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Speech Rate</label>
                                    <input type="range" class="form-range" min="0.5" max="2" step="0.1" onchange="VoiceKernel.rate=this.value">
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">System Diagnostics</div>
                            <div class="card-body">
                                <div class="flex justify-between items-center mb-4 p-3 bg-white/5 rounded">
                                    <span>Database Integrity</span>
                                    <span class="text-success font-bold">OPTIMAL</span>
                                </div>
                                <div class="flex justify-between items-center mb-4 p-3 bg-white/5 rounded">
                                    <span>AI Engine Latency</span>
                                    <span class="text-warning font-bold">~32ms</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="toast-area" class="toast-wrapper"></div>

    <script>
        // --- 1. CORE UTILITIES ---
        const $ = (id) => document.getElementById(id);
        
        /**
         * MODULE: DataKernel
         * Handles LocalStorage Persistence and Logging
         */
        class DataManager {
            constructor() {
                this.logs = JSON.parse(localStorage.getItem('vc_logs')) || [];
            }

            log(source, event, type = 'INFO') {
                const entry = {
                    time: new Date().toLocaleTimeString(),
                    source,
                    event,
                    type
                };
                this.logs.unshift(entry);
                if (this.logs.length > 100) this.logs.pop();
                localStorage.setItem('vc_logs', JSON.stringify(this.logs));
                this.renderLogs();
            }

            renderLogs() {
                const tbody = $('log-body');
                if (!tbody) return;
                tbody.innerHTML = this.logs.map(l => `
                    <tr style="border-bottom:1px solid rgba(255,255,255,0.05)">
                        <td class="p-4 font-mono text-accent">${l.time}</td>
                        <td class="p-4 font-bold">${l.source}</td>
                        <td class="p-4">${l.event}</td>
                        <td class="p-4"><span class="badge ${l.type === 'CRIT' ? 'badge-danger' : 'badge-success'}">${l.type}</span></td>
                    </tr>
                `).join('');
            }

            clear() {
                this.logs = [];
                localStorage.removeItem('vc_logs');
                this.renderLogs();
                AppKernel.notify("System", "Logs Purged", false);
            }
        }

        /**
         * MODULE: AppKernel
         * Main Application Controller
         */
        const AppKernel = {
            data: new DataManager(),
            
            init: () => {
                setInterval(() => $('sys-clock').innerText = new Date().toLocaleTimeString(), 1000);
                AppKernel.data.renderLogs();
                BioKernel.startECG(1);
                BioKernel.startECG(2);
            },

            login: () => {
                const u = $('login-id').value;
                const p = $('login-key').value;
                if(u === 'admin' && p === 'admin123') {
                    $('auth-view').style.display = 'none';
                    $('app-shell').classList.remove('hidden');
                    setTimeout(() => $('app-shell').style.opacity = 1, 100);
                    VoiceKernel.speak("Vision Care Enterprise Online.");
                } else {
                    alert("Access Denied");
                }
            },

            notify: (title, msg, isCritical) => {
                const area = $('toast-area');
                const t = document.createElement('div');
                t.className = `toast ${isCritical ? 'danger' : ''}`;
                t.innerHTML = `
                    <div style="font-size:1.5rem">${isCritical ? 'üö®' : 'üîî'}</div>
                    <div><div class="font-bold">${title}</div><small>${msg}</small></div>
                `;
                area.appendChild(t);
                // Force Reflow
                void t.offsetWidth; 
                t.classList.add('show');
                
                VoiceKernel.speak(msg);
                
                setTimeout(() => {
                    t.classList.remove('show');
                    setTimeout(() => t.remove(), 400);
                }, 4000);

                AppKernel.data.log("System", msg, isCritical ? 'CRIT' : 'INFO');
            }
        };

        const Router = {
            navigate: (viewId) => {
                document.querySelectorAll('.view-page').forEach(el => el.classList.remove('active'));
                $(`view-${viewId}`).classList.add('active');
                
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                event.currentTarget.classList.add('active');
                
                VoiceKernel.speak(`Opening ${viewId}`);
            }
        };

        /**
         * MODULE: VisionKernel
         * Handles MediaPipe Holistic AI
         */
        const VisionKernel = {
            video: $('vid_feed'),
            canvas: $('cv_canvas'),
            ctx: $('cv_canvas').getContext('2d'),
            twinCtx: $('twin_canvas').getContext('2d'),
            lastAction1: "",
            lastAction2: "",

            start: async () => {
                $('ai-stat').innerText = "LOADING...";
                const holistic = new Holistic({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`});
                
                holistic.setOptions({
                    modelComplexity: 1,
                    smoothLandmarks: true,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });
                
                holistic.onResults(VisionKernel.process);

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 1280, height: 720 } });
                    VisionKernel.video.srcObject = stream;
                    VisionKernel.video.onloadedmetadata = () => {
                        VisionKernel.video.play();
                        $('ai-stat').innerText = "ACTIVE";
                        const cam = new Camera(VisionKernel.video, {
                            onFrame: async () => { await holistic.send({image: VisionKernel.video}); },
                            width: 1280, height: 720
                        });
                        cam.start();
                    };
                } catch(e) { alert("Camera Access Denied"); }
            },

            process: (results) => {
                const w = VisionKernel.canvas.width = VisionKernel.video.videoWidth;
                const h = VisionKernel.canvas.height = VisionKernel.video.videoHeight;
                $('twin_canvas').width = w; $('twin_canvas').height = h;

                // Main Overlay
                const ctx = VisionKernel.ctx;
                ctx.save();
                ctx.clearRect(0, 0, w, h);
                ctx.drawImage(results.image, 0, 0, w, h);
                // Bed Splitter
                ctx.beginPath(); ctx.moveTo(w/2, 0); ctx.lineTo(w/2, h); 
                ctx.strokeStyle="rgba(255,255,255,0.3)"; ctx.lineWidth=4; ctx.stroke();
                
                if(results.leftHandLandmarks) {
                    drawConnectors(ctx, results.leftHandLandmarks, HAND_CONNECTIONS, {color: '#6366f1'});
                    VisionKernel.logic(results.leftHandLandmarks);
                }
                if(results.rightHandLandmarks) {
                    drawConnectors(ctx, results.rightHandLandmarks, HAND_CONNECTIONS, {color: '#6366f1'});
                    VisionKernel.logic(results.rightHandLandmarks);
                }
                ctx.restore();

                // Twin Overlay
                const tCtx = VisionKernel.twinCtx;
                tCtx.save(); tCtx.clearRect(0,0,w,h);
                drawConnectors(tCtx, results.poseLandmarks, POSE_CONNECTIONS, {color: '#06b6d4', lineWidth: 4});
                tCtx.restore();
            },

            logic: (lm) => {
                const x = lm[0].x; 
                const bedId = x < 0.5 ? 1 : 2;
                
                let f = 0;
                // Count Fingers (Tip Y < PIP Y)
                if(lm[8].y < lm[6].y) f++;
                if(lm[12].y < lm[10].y) f++;
                if(lm[16].y < lm[14].y) f++;
                if(lm[20].y < lm[18].y) f++;
                if(Math.abs(lm[4].x - lm[5].x) > 0.05) f++;

                const pinch = Math.hypot(lm[4].x - lm[8].x, lm[4].y - lm[8].y) < 0.05;

                // Update Debug HUD
                if(bedId === 1) $('hud-hands').innerText = `${f} / ${$('hud-hands').innerText.split('/')[1]}`;
                else $('hud-hands').innerText = `${$('hud-hands').innerText.split('/')[0]} / ${f}`;

                let msg = "";
                if(pinch) msg = "FAN ON";
                else if(f === 0) msg = "PAIN";
                else if(f === 2) msg = "WATER";
                else if(f === 5) msg = "LIGHTS";

                $('hud-cmd').innerText = msg || "--";

                // Independent Debouncing
                if(bedId === 1 && msg && msg !== VisionKernel.lastAction1) {
                    VisionKernel.lastAction1 = msg;
                    RoomKernel.handle(1, msg);
                    setTimeout(() => VisionKernel.lastAction1 = "", 2000);
                }
                if(bedId === 2 && msg && msg !== VisionKernel.lastAction2) {
                    VisionKernel.lastAction2 = msg;
                    RoomKernel.handle(2, msg);
                    setTimeout(() => VisionKernel.lastAction2 = "", 2000);
                }
            }
        };

        /**
         * MODULE: RoomKernel
         * IoT Device Control
         */
        const RoomKernel = {
            handle: (id, msg) => {
                $(`req-p${id}`).innerText = msg;
                if(msg === "PAIN") {
                    $(`card-p${id}`).classList.add('status-danger');
                    $(`bdg-p${id}`).className = "badge badge-crit";
                    $(`bdg-p${id}`).innerText = "CRITICAL";
                    AppKernel.notify(`BED ${id}`, "EMERGENCY: PAIN DETECTED", true);
                } else {
                    if(msg.includes("FAN")) $(`btn-fan-p${id}`).classList.add('active', 'spin');
                    if(msg.includes("LIGHT")) $(`btn-light-p${id}`).classList.add('active');
                    AppKernel.notify(`Bed ${id}`, `Request: ${msg}`, false);
                }
            }
        };

        /**
         * MODULE: BioKernel
         * Physics Simulation for ECG
         */
        const BioKernel = {
            startECG: (id) => {
                const c = $(`ecg-p${id}`);
                const ctx = c.getContext('2d');
                c.width = c.offsetWidth; c.height = c.offsetHeight;
                let x = 0;
                ctx.strokeStyle = '#10b981'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(0, c.height/2);

                function draw() {
                    x += 2;
                    if(x > c.width) { x = 0; ctx.clearRect(0,0,c.width,c.height); ctx.beginPath(); ctx.moveTo(0,c.height/2); }
                    
                    let y = c.height/2;
                    // P-QRS-T Wave Simulation
                    if (x % 150 > 10 && x % 150 < 30) y -= 5; // P
                    else if (x % 150 > 30 && x % 150 < 40) y += 5; // Q
                    else if (x % 150 > 40 && x % 150 < 50) y -= 40; // R
                    else if (x % 150 > 50 && x % 150 < 60) y += 10; // S
                    else if (x % 150 > 80 && x % 150 < 100) y -= 8; // T
                    
                    // Noise
                    y += (Math.random() - 0.5) * 2;

                    ctx.lineTo(x, y); ctx.stroke();
                    requestAnimationFrame(draw);
                }
                draw();
            }
        };

        /**
         * MODULE: VoiceKernel
         */
        const VoiceKernel = {
            volume: 1,
            rate: 1,
            listening: false,
            
            speak: (text) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.volume = VoiceKernel.volume;
                u.rate = VoiceKernel.rate;
                window.speechSynthesis.speak(u);
            },

            toggle: () => {
                if(!window.webkitSpeechRecognition) return alert("Browser does not support Voice");
                
                const rec = new webkitSpeechRecognition();
                rec.lang = 'en-US';
                rec.start();
                
                rec.onstart = () => VoiceKernel.speak("Listening");
                rec.onresult = (e) => {
                    const t = e.results[0][0].transcript.toLowerCase();
                    AppKernel.notify("Voice", t, false);
                    if(t.includes("fan")) RoomKernel.handle(1, "FAN ON");
                    if(t.includes("light")) RoomKernel.handle(1, "LIGHT ON");
                };
            }
        };

        // STARTUP
        AppKernel.init();

    </script>
</body>
</html>
